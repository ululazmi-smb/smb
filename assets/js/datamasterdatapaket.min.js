var id_paket = "", status_user;
var title_id = document.getElementById("title_id");
let url, pelanggan = $("#paket").DataTable({
    responsive: true,
    scrollX: true,
    ajax: readUrl,
    columnDefs: [{
        searcable: false,
        orderable: false,
        targets: 0
    }],
    order: [
        [1, "asc"]
    ],
    columns: [{
        data: null
    }, {
        data: "paket"
    }, {
        data: "harga", render: $.fn.dataTable.render.number( '.', '.', 0, 'Rp' )
    }, {
        data: "action"
    }]
});

function save()
{
    if(status_user == "add")
    {
        var data = {
            status : status_user,
            nama : $("#nama").val(),
            harga: $("#harga").val()
        };
    } else if(status_user == "edit")
    {
        var data = {
            id : id_paket,
            status : status_user,
            nama : $("#nama").val(),
            harga: $("#harga").val()
        };
    }
    $.ajax({
        url: addUrlPaket,
        type: "POST",
        dataType: "json",
        data: data,
        success: res => {
            id_user = "";
            if(res.error == "success")
            {
                $("#nama").val("");
                $("#harga").val("");
                Swal.fire("Berhasil", res.messages, "success");
                $(".modal").modal("hide");
                reloadTable();
            } else {
                Swal.fire("Galat", res.messages, "error");
            }
        },
        error: err => {
            id_user = "";
            console.log(err)
        }
    })
}

function edit(id){
    $("#nama").val("");
    $("#harga").val("");
    id_paket = id;
    status_user = "edit";
    title_id.innerHTML = "edit pelanggan";
    $.ajax({
        url: getUrlPaket,
        type: "POST",
        dataType: "json",
        data: {
            id : id
        },
        success: res => {
            id_user = "";
            if(res.error == "success")
            {
                $("#nama").val(res.data.nama);
                $("#harga").val(res.data.harga);
            } else {
                Swal.fire("Galat", res.messages, "error");
            }
        },
        error: err => {
            id_user = "";
            console.log(err)
        }
    })
}

function add(){
    $("#nama").val("");
    $("#harga").val("");
    title_id.innerHTML = "tambah pelanggan";
    status_user = "add";
}

function reloadTable() {
    pelanggan.ajax.reload()
}

pelanggan.on("order.dt search.dt", () => {
    pelanggan.column(0, {
        search: "applied",
        order: "applied"
    }).nodes().each((el, val) => {
        el.innerHTML = val + 1
    })
});

